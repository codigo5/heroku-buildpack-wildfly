#!/usr/bin/env bash
# bin/release <build-dir>

set -e

BUILD_DIR=$1
WILDFLY_VERSION="12.0.0.Final"
JBOSS_HOME=".jboss/wildfly-${WILDFLY_VERSION}"

echo -n "-----> Deploying war file(s)..."
cp target/*.war $JBOSS_HOME/standalone/deployments/
echo "done"

echo "-----> Creating configuration..."
if [ -f $BUILD_DIR/Procfile ]; then
  echo "        - Using existing process types"
else
  cat << EOF > $BUILD_DIR/Procfile
web: \$JBOSS_HOME/bin/standalone.sh -b=0.0.0.0 -Djboss.http.port=\$PORT
EOF
fi

cat << EOF > $BUILD_DIR/.profile.d/jboss.sh
export JBOSS_HOME=${JBOSS_HOME}
EOF
